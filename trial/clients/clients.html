<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Client Management | WALAKA</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar Menu -->
    <nav class="sidebar">
      <div class="logo">
        <i class="fas fa-chart-line"></i>
        <span>WALAKA</span>
      </div>
      <div class="nav-menu">
        <a href="../dashboard.html" class="nav-item">
          <i class="fas fa-home"></i>
          <span>Dashboard</span>
        </a>
        <div class="nav-section">
          <h3>Invoicing</h3>
        </div>
        <a href="../invoices.html" class="nav-item">
          <i class="fas fa-file-invoice-dollar"></i>
          <span>Invoices</span>
        </a>
        <a href="../clients/clients.html" class="nav-item active">
          <i class="fas fa-users"></i>
          <span>Clients</span>
        </a>
        <a href="../products.html" class="nav-item">
          <i class="fas fa-shopping-cart"></i>
          <span>Products</span>
        </a>
        <div class="nav-section">
          <h3>Commercial</h3>
        </div>
        <a href="#" class="nav-item">
          <i class="fas fa-boxes"></i>
          <span>Stock</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-truck"></i>
          <span>Suppliers</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-exchange-alt"></i>
          <span>Movements</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-money-bill-wave"></i>
          <span>Expenses</span>
        </a>
        <div class="nav-section">
          <h3>Accounting</h3>
        </div>
        <a href="#" class="nav-item">
          <i class="fas fa-book"></i>
          <span>Entries</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-list-alt"></i>
          <span>Chart of Accounts</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-percent"></i>
          <span>Taxes</span>
        </a>
        <div class="nav-section">
          <h3>Finances</h3>
        </div>
        <a href="#" class="nav-item">
          <i class="fas fa-chart-pie"></i>
          <span>Reports</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-chart-line"></i>
          <span>Key Metrics</span>
        </a>
        <div class="nav-section">
          <h3>Settings</h3>
        </div>
        <a href="../settings.html" class="nav-item">
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </a>
        <a href="../profile.html" class="nav-item">
          <i class="fas fa-user-cog"></i>
          <span>Account</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-question-circle"></i>
          <span>Help</span>
        </a>
      </div>
    </nav>
    <!-- Main Content Area -->
    <main class="main-container">
      <header class="top-bar">
        <div class="hamburger-menu" id="hamburger-menu">
          <i class="fas fa-bars"></i>
        </div>
        
        <div class="search-bar">
          <input type="text" placeholder="Search..." aria-label="Search">
          <button type="button" aria-label="Search button">
            <i class="fas fa-search"></i>
          </button>
        </div>

        <div class="user-menu">
          <div class="notification-bell">
            <i class="fas fa-bell"></i>
            <span class="badge">3</span>
          </div>
          
          <div class="user-profile dropdown">
            <div class="avatar">
              <i class="fas fa-user"></i>
            </div>
            <span class="user-name">Admin</span>
            <button class="dropdown-toggle" aria-label="Toggle Dropdown">
              <i class="fas fa-chevron-down"></i>
            </button>
            <div class="dropdown-menu">
              <a href="#">My Profile</a>
              <a href="#">Settings</a>
              <a href="#">Log Out</a>
            </div>
          </div>
        </div>
      </header>

      <div class="content-wrapper">
        <div class="container">
          <div class="page-header">
            <h1>Client Management</h1>
            <button id="add-new-client-btn" class="primary-btn">
              <i class="fas fa-plus"></i> Add New Client
            </button>
          </div>

          <div class="client-management">
            <!-- Client Form Section -->
            <section class="frame frame-left" id="client-form-container">
              <h2 id="form-title">Novo Cliente</h2>
              <form id="client-form">
                <div class="form-group">
                  <label>Client Type</label>
                  <div class="radio-group">
                    <label class="radio-label">
                      <input type="radio" name="client-type" value="business" checked>
                      Business
                    </label>
                    <label class="radio-label">
                      <input type="radio" name="client-type" value="individual">
                      Individual
                    </label>
                  </div>
                </div>

                <div class="form-group">
                  <label for="company-name">Nome da Empresa</label>
                  <input type="text" id="company-name" name="company_name" required placeholder="Nome da Empresa">
                </div>
                <div class="form-group">
                  <label for="customer-tax-id">NIF/NUIT</label>
                  <input type="text" id="customer-tax-id" name="customer_tax_id" placeholder="NIF/NUIT">
                </div>
                <div class="form-group">
                  <label for="contact">Contato</label>
                  <input type="text" id="contact" name="contact" placeholder="Contato">
                </div>
                <div class="form-group">
                  <label for="billing-address">Endereço de Faturação</label>
                  <input type="text" id="billing-address" name="billing_address" placeholder="Endereço de Faturação">
                </div>
                <div class="form-group">
                  <label for="street-name">Rua</label>
                  <input type="text" id="street-name" name="street_name" placeholder="Rua">
                </div>
                <div class="form-group">
                  <label for="address-detail">Detalhe do Endereço</label>
                  <input type="text" id="address-detail" name="address_detail" placeholder="Detalhe do Endereço">
                </div>
                <div class="form-group">
                  <label for="city">Cidade</label>
                  <input type="text" id="city" name="city" placeholder="Cidade">
                </div>
                <div class="form-group">
                  <label for="postal-code">Código Postal</label>
                  <input type="text" id="postal-code" name="postal_code" placeholder="Código Postal">
                </div>
                <div class="form-group">
                  <label for="province">Província</label>
                  <input type="text" id="province" name="province" placeholder="Província">
                </div>
                <div class="form-group">
                  <label for="country">País</label>
                  <input type="text" id="country" name="country" placeholder="País">
                </div>
                <div class="form-group">
                  <label for="ship-to-address">Endereço de Entrega</label>
                  <input type="text" id="ship-to-address" name="ship_to_address" placeholder="Endereço de Entrega">
                </div>
                <div class="form-group">
                  <label for="building-number">Número do Prédio</label>
                  <input type="text" id="building-number" name="building_number" placeholder="Número do Prédio">
                </div>
                <div class="form-group">
                  <label for="telephone">Telefone</label>
                  <input type="text" id="telephone" name="telephone" placeholder="Telefone">
                </div>
                <div class="form-group">
                  <label for="fax">Fax</label>
                  <input type="text" id="fax" name="fax" placeholder="Fax">
                </div>
                <div class="form-group">
                  <label for="email">Email</label>
                  <input type="email" id="email" name="email" placeholder="Email">
                </div>
                <div class="form-group">
                  <label for="website">Website</label>
                  <input type="text" id="website" name="website" placeholder="Website">
                </div>
                <div class="form-footer">
                  <button type="submit" id="save-client-btn" class="primary-btn">Salvar Cliente</button>
                  <button type="button" id="cancel-btn" class="secondary-btn">Cancelar</button>
                </div>
              </form>
            </section>

            <!-- Client List Section -->
            <section class="frame frame-right" id="client-list-container">
              <div class="search-bar-frame">
                <div class="search-input-wrapper">
                  <i class="fas fa-search"></i>
                  <input type="text" id="client-search" placeholder="Search clients...">
                </div>
                <div class="filter-options">
                  <select id="status-filter">
                    <option value="all">All Statuses</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                  </select>
                  <select id="type-filter">
                    <option value="all">All Types</option>
                    <option value="business">Business</option>
                    <option value="individual">Individual</option>
                  </select>
                </div>
              </div>
              
              <div class="client-list-header">
                <h3>Client List</h3>
                <div class="view-options">
                  <button id="grid-view-btn" class="view-btn active" aria-label="Grid view">
                    <i class="fas fa-th-large"></i>
                  </button>
                  <button id="list-view-btn" class="view-btn" aria-label="List view">
                    <i class="fas fa-list"></i>
                  </button>
                </div>
              </div>
              
              <div id="client-list" class="client-list grid-view">
                <!-- Client items will be populated by JavaScript -->
                <div class="loading-indicator">
                  <i class="fas fa-spinner fa-spin"></i>
                  <span>Loading clients...</span>
                </div>
              </div>
              
              <div class="pagination-controls">
                <button id="prev-page" class="pagination-btn" disabled>
                  <i class="fas fa-chevron-left"></i> Previous
                </button>
                <span id="page-info">Page 1 of 1</span>
                <button id="next-page" class="pagination-btn" disabled>
                  Next <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </section>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal for Contact Person -->
  <div id="contact-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add Contact Person</h3>
        <button type="button" class="close-modal" aria-label="Close modal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <form id="contact-form">
          <div class="form-row">
            <div class="form-group select-wrapper">
              <label for="contact-salutation">Salutation</label>
              <select id="contact-salutation" name="contact-salutation">
                <option value="">Select...</option>
                <option value="Mr.">Mr.</option>
                <option value="Ms.">Ms.</option>
                <option value="Mrs.">Mrs.</option>
                <option value="Dr.">Dr.</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="contact-first-name">First Name</label>
              <input type="text" id="contact-first-name" name="contact-first-name" required placeholder="First Name">
            </div>
            
            <div class="form-group">
              <label for="contact-last-name">Last Name</label>
              <input type="text" id="contact-last-name" name="contact-last-name" required placeholder="Last Name">
            </div>
          </div>
          
          <div class="form-group">
            <label for="contact-email">Email Address</label>
            <div class="email-input-wrapper">
              <i class="fas fa-envelope"></i>
              <input type="email" id="contact-email" name="contact-email" required placeholder="contact@example.com">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="contact-work-phone">Work Phone</label>
              <div class="phone-input-wrapper">
                <i class="fas fa-phone"></i>
                <input type="tel" id="contact-work-phone" name="contact-work-phone" placeholder="Work Phone">
              </div>
            </div>
            
            <div class="form-group">
              <label for="contact-mobile">Mobile</label>
              <div class="phone-input-wrapper">
                <i class="fas fa-mobile-alt"></i>
                <input type="tel" id="contact-mobile" name="contact-mobile" placeholder="Mobile">
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="contact-designation">Designation/Role</label>
            <input type="text" id="contact-designation" name="contact-designation" placeholder="e.g. Accountant, Manager">
          </div>
          
          <div class="form-group">
            <label for="is-primary-contact">Primary Contact?</label>
            <div class="checkbox-wrapper">
              <input type="checkbox" id="is-primary-contact" name="is-primary-contact">
              <label for="is-primary-contact">Set as primary contact for this client</label>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="save-contact-btn" class="primary-btn">Save Contact</button>
        <button type="button" id="cancel-contact-btn" class="secondary-btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Confirm Deletion</h3>
        <button type="button" class="close-modal" aria-label="Close modal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this client? This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button type="button" id="confirm-delete-btn" class="danger-btn">Delete</button>
        <button type="button" id="cancel-delete-btn" class="secondary-btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast">
    <div class="toast-content">
      <i id="toast-icon" class="fas fa-check-circle"></i>
      <div class="toast-message" id="toast-message">Client saved successfully!</div>
    </div>
    <button class="toast-close" id="toast-close" aria-label="Close notification">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <script src="./scripts.js"></script>
  <script src="./client-form.js"></script>
  <script src="./client-list.js"></script>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.0.0/+esm';

    const supabaseUrl = 'https://qvmtozjvjflygbkjecyj.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF2bXRvemp2amZseWdia2plY3lqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYxMjc2MjMsImV4cCI6MjA2MTcwMzYyM30.DJMC1eM5_EouM1oc07JaoXsMX_bSLn2AVCozAcdfHmo';
    
    // Initialize Supabase client and make it globally available
    window.supabase = createClient(supabaseUrl, supabaseKey);

    async function displayUserName() {
      try {
        const { data: { session }, error } = await window.supabase.auth.getSession();
        if (error) throw error;
        
        const userNameSpan = document.querySelector('.user-name');
        if (!userNameSpan) return;

        if (!session?.user) {
          userNameSpan.textContent = 'Não logado';
          return;
        }

        const { data: profileData, error: profileError } = await window.supabase
          .from('users')
          .select('username, logo')
          .eq('id', session.user.id)
          .single();

        if (profileError) throw profileError;

        userNameSpan.textContent = profileData?.username || 'Usuário';

        const userAvatar = document.querySelector('.avatar');
        if (userAvatar && profileData?.logo) {
          userAvatar.innerHTML = `<img src="${profileData.logo}" alt="User Logo" style="width: 100%; height: 100%; border-radius: 50%;">`;
        }
      } catch (err) {
        console.error('Error displaying user:', err);
      }
    }

    // Initialize the app after Supabase is ready
    window.addEventListener('DOMContentLoaded', async () => {
      await displayUserName();
      if (typeof window.initClientList === 'function') {
        window.initClientList();
      }
    });
  </script>
  <script>
    const menuToggle = document.createElement('div');
    menuToggle.className = 'menu-toggle';
    menuToggle.innerHTML = '<i class="fas fa-bars"></i>';
    document.querySelector('.top-bar').prepend(menuToggle);

    menuToggle.addEventListener('click', () => {
      document.querySelector('.sidebar').classList.toggle('active');
    });

    window.addEventListener('load', () => {
      document.body.classList.add('loaded');
    });
  </script>
</body>
</html>
<script
